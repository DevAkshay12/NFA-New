sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";var t;var a;var o;var s,n,r,i;n=/PAN_Number='([^']+)'/;o=location.href;i=o.match(n);var l=new sap.m.BusyDialog({title:"Sending for Approval",text:"Please wait..."});if(i){a=i[1];console.log(a)}else{console.log("PAN Number not found")}return e.extend("nfaform.ext.controller.Objectpage",{override:{onInit:function(){},editFlow:{onBeforeSave:async function(e){r=this;const t=this;t._sendForApproval=false;const a=new Promise(async(e,a)=>{debugger;var o=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var s=o.getValue();var n=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");n.setUploadButtonInvisible(false);n.setUploadEnabled(false);if(n.getItems()){for(let e=0;e<n.getItems().length;e++){n.getItems()[0].setEnabledRemove(false);n.getItems()[0].setVisibleRemove(false)}}sap.m.MessageBox.confirm("Do you want to send for Approval?",{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(n){if(n===sap.m.MessageBox.Action.YES){debugger;l.open();if(s.length==0){const e=new sap.ui.model.json.JSONModel([{type:"Error",title:"Comments Required",description:"Comments cannot be empty. Please enter a value",subtitle:"Comments section"}]);const t=new sap.m.MessagePopover({items:{path:"/",template:new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}"})}});t.setModel(e);t.openBy(o);a(true)}else{var i="rajendraakshay1@gmail.com";console.log("Save action confirmed");e(true);r.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].addStyleClass("edit")}t._sendForApproval=true}else{console.log("Save action cancelled");e(true);o.setEditable(false);sap.m.MessageToast.show("cancelled",{duration:3e3,width:"15em",my:"center bottom",at:"center bottom"})}}})});await a},onAfterSave:async function(e){if(!this._sendForApproval){console.log("Skipping sendforapproval - user chose not to send.");return}debugger;var t=sap.ushell.Container.getUser().getEmail();const o=this.getView().getModel().bindContext("/sendforapproval(...)");const s=JSON.stringify({key:a,status:"Approval",name:t});o.setParameter("data",s);await o.execute();debugger;var n=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var r=n.getValue();if(r.length>0){console.log("Save action confirmed");debugger;var i=e.context.getModel().bindContext(`/${"comment"}(...)`);var t=sap.ushell.Container.getUser().getEmail();var m={type:"insert",NFA_Number:a,comment:r,user:t,status:"demo"};m=JSON.stringify(m);i.setParameter("data",m);await i.execute();let o=i.getBoundContext();let s=o.getObject();n.setEditable(false)}setTimeout(function(){l.close();window.history.go(-2)},2e3)},onAfterDiscard:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var a=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var o=t.getValue();t.setEditable(false);a.setUploadButtonInvisible(true);a.setUploadEnabled(false);if(a.getItems()){for(let e=0;e<a.getItems().length;e++){a.getItems()[e].setEnabledRemove(false);a.getItems()[e].setVisibleRemove(false)}}},onBeforeEdit:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var a=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");a.setEditable(true);t.setUploadButtonInvisible(false);t.setUploadEnabled(true);if(t.getItems()){for(let e=0;e<t.getItems().length;e++){t.getItems()[e].setEnabledRemove(true);t.getItems()[e].setVisibleRemove(true)}}}},routing:{onAfterBinding:async function(e){debugger;var t;s=this;var o=s.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;const r=/PAN_Number='([^']+)'/;var i=location.href;const l=i.match(r);var m=o+`odata/v4/catalog/tab1?$filter=PAN_Number eq '${l[1]}'`;$.ajax({url:m,method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){debugger;t=e.value[0].status;if(t=="pending for Approval"||t=="Approved"){s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].addStyleClass("edit")}else{s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].removeStyleClass("edit")}console.log("Data retrieved successfully:",e)}).catch(function(e){debugger;console.error("Error occurred during AJAX call:",e)});if(!this._attachmentsInitialized){this._attachmentsInitialized=true;var g=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var c=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var u=location.href.match(/IsActiveEntity=([^,)]+)/);var d=u[1];if(d==="true"){c.setEditable(false);g.setUploadButtonInvisible(true);g.setUploadEnabled(false);if(g.getItems()){for(let e=0;e<g.getItems().length;e++){g.getItems()[0].setEnabledRemove(false);g.getItems()[0].setVisibleRemove(false)}}}else{c.setEditable(true);g.setUploadButtonInvisible(false);g.setUploadEnabled(true);if(g.getItems()){for(let e=0;e<g.getItems().length;e++){g.getItems()[0].setEnabledRemove(true);g.getItems()[0].setVisibleRemove(true)}}}}o=this.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;debugger;var f=sap.ui.getCore().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Workflow--sampleTable");f.addStyleClass("workFlowTable");f.addStyleClass("sapUiRespGrid");f.addStyleClass("sapUiRespGridHSpace1");if(!f){console.error("Table not found.");return}var b={url:o+"odata/v4/catalog/WORKFLOW_HISTORY",method:"GET",headers:{Accept:"application/json"}};new Promise((e,t)=>{$.ajax(b).done(async(a,o,s)=>{console.log("AJAX Results:",a);if(!a.value||!Array.isArray(a.value)){console.error("Invalid AJAX response structure. Expected `results.value` to be an array.");return t("Invalid data structure")}const n=location.href;const r=/PAN_Number='([^']+)'/;const i=n.match(r);if(!i||!i[1]){console.error("PAN Number not found in URL.");return t("PAN Number extraction failed")}const l=i[1];const m=a.value.filter(e=>e.PAN_Number===l);console.log("Filtered Results:",m);if(m.length===0){console.warn("No data found for the given PAN Number:",l)}const g=new sap.ui.model.json.JSONModel;g.setData({PAN_WORKFLOW_HISTORY_APR:m});f.setModel(g);console.log("Model Data:",g.getData());await new Promise(e=>setTimeout(e,1e3));f.bindItems({path:"/PAN_WORKFLOW_HISTORY_APR",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{PAN_Number}"}),new sap.m.Text({text:"{Employee_Name}"}),new sap.m.Text({text:"{level}"}),new sap.m.Text({text:"{Remarks}"}),new sap.m.Text({text:"{Approved_by}"}),new sap.m.Text({text:"{Days_Taken}"})]})});console.log("Table Model Data:",f.getModel().oData);e(a)}).fail(e=>{console.error("AJAX request failed:",e);t(e)})});var p=[{header:"PAN Number",path:"PAN_Number"},{header:"Employee Name",path:"Employee_Name"},{header:"Level",path:"level"},{header:"Status",path:"Remarks"},{header:"Approved By",path:"Approved_by"},{header:"Days Taken",path:"Days_Taken"}];f.destroyColumns();p.forEach(function(e){var t=new sap.m.Column({header:new sap.m.Text({text:e.header})});f.addColumn(t)});var v=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var h=this.getView().getModel().bindContext(`/${"comment"}(...)`);n=/PAN_Number='([^']+)'/;m=location.href;u=m.match(n);a=u[1];var y={type:"get",NFA_Number:a};y=JSON.stringify(y);h.setParameter("data",y);await h.execute();let A=h.getBoundContext();let S=A.getObject();S=JSON.parse(S.value);debugger;console.log("Execution Result:",S);if(S[0]&&S[0].Comments){v.setValue(S[0].Comments);console.log("Comment data updated:",S[0].Comments)}else{v.setValue("");console.warn("No comments found. Setting to empty.")}return S}}}})});
//# sourceMappingURL=Objectpage.controller.js.map