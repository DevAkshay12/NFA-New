sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";var t;var a;var o;var s,n,r;n=/PAN_Number='([^']+)'/;o=location.href;r=o.match(n);if(r){a=r[1];console.log(a)}else{console.log("PAN Number not found")}return e.extend("nfaform.ext.controller.Objectpage",{override:{onInit:function(){},editFlow:{onAfterSave:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");t.setEditable(false);var o=t.getValue();if(o.length>0){debugger;console.log("Save action confirmed");var n=e.context.getModel().bindContext(`/${"comment"}(...)`);var r=sap.ushell.Container.getUser().getEmail();o={type:"insert",NFA_Number:a,comment:o,user:r,status:"demo"};o=JSON.stringify(o);n.setParameter("data",o);await n.execute();let t=n.getBoundContext();let s=t.getObject();s=JSON.parse(s.value)}var i=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");i.setUploadButtonInvisible(false);i.setUploadEnabled(false);if(i.getItems()){for(let e=0;e<i.getItems().length;e++){i.getItems()[0].setEnabledRemove(false);i.getItems()[0].setVisibleRemove(false)}}sap.m.MessageBox.confirm("Do you want to send for Approval?",{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(t){if(t===sap.m.MessageBox.Action.YES){debugger;var o=s.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");if(o.getValue().length==0){const e=new sap.ui.model.json.JSONModel([{type:"Error",title:"Comments Required",description:"Comments cannot be empty. Please enter a value",subtitle:"Comments section"}]);const t=new sap.m.MessagePopover({items:{path:"/",template:new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}"})}});t.setModel(e);t.openBy(o)}debugger;var n=sap.ushell.Container.getUser().getEmail();console.log("Save action confirmed");var r=e.context.getModel().bindContext(`/${"sendforapproval"}(...)`);var i={key:a,status:"Approval",name:n};i=JSON.stringify(i);r.setParameter("data",i);await r.execute();let t=r.getBoundContext();let l=t.getObject();l=JSON.parse(l.value)}else{console.log("Save action cancelled")}}})},onBeforeEdit:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var a=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");a.setEditable(true);t.setUploadButtonInvisible(false);t.setUploadEnabled(true);if(t.getItems()){for(let e=0;e<t.getItems().length;e++){t.getItems()[0].setEnabledRemove(true);t.getItems()[0].setVisibleRemove(true)}}}},routing:{onAfterBinding:async function(e){debugger;var t;s=this;var o=s.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;const r=/PAN_Number='([^']+)'/;var i=location.href;const l=i.match(r);var m=o+`odata/v4/catalog/tab1?$filter=PAN_Number eq '${l[1]}'`;$.ajax({url:m,method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){debugger;t=e.value[0].status;if(t=="pending for Approval"||t=="Approved"){s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].addStyleClass("edit")}else{s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].removeStyleClass("edit")}console.log("Data retrieved successfully:",e)}).catch(function(e){debugger;console.error("Error occurred during AJAX call:",e)});if(!this._attachmentsInitialized){this._attachmentsInitialized=true;var c=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var u=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var g=location.href.match(/IsActiveEntity=([^,)]+)/);var d=g[1];if(d==="true"){u.setEditable(false);c.setUploadButtonInvisible(true);c.setUploadEnabled(false);if(c.getItems()){for(let e=0;e<c.getItems().length;e++){c.getItems()[0].setEnabledRemove(false);c.getItems()[0].setVisibleRemove(false)}}}else{u.setEditable(true);c.setUploadButtonInvisible(false);c.setUploadEnabled(true);if(c.getItems()){for(let e=0;e<c.getItems().length;e++){c.getItems()[0].setEnabledRemove(true);c.getItems()[0].setVisibleRemove(true)}}}}o=this.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;debugger;var f=sap.ui.getCore().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Workflow--sampleTable");f.addStyleClass("workFlowTable");f.addStyleClass("sapUiRespGrid");f.addStyleClass("sapUiRespGridHSpace1");if(!f){console.error("Table not found.");return}var b={url:o+"odata/v4/catalog/PAN_WORKFLOW_HISTORY_APR",method:"GET",headers:{Accept:"application/json"}};new Promise((e,t)=>{$.ajax(b).done(async(t,o,s)=>{var r=new sap.ui.model.json.JSONModel;m=location.href;n=/PAN_Number='([^']+)'/;g=m.match(n);a=g[1];const i=t.value.filter(e=>e.PAN_Number===a);r.setData({PAN_WORKFLOW_HISTORY_APR:i});f.setModel(r);console.log(t);await new Promise(e=>setTimeout(e,2e3));f.bindItems({path:"/PAN_WORKFLOW_HISTORY_APR",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{PAN_Number}"}),new sap.m.Text({text:"{Employee_Name}"}),new sap.m.Text({text:"{level}"}),new sap.m.Text({text:"{Notification_Status}"}),new sap.m.Text({text:"{Approved_by}"})]})});e(t)}).fail(e=>{t(e)})});var p=[{header:"PAN Number",path:"PAN_Number"},{header:"Employee Name",path:"Employee_Name"},{header:"Level",path:"level"},{header:"Status",path:"Notification_Status"},{header:"Approved By",path:"Approved_by"}];f.destroyColumns();p.forEach(function(e){var t=new sap.m.Column({header:new sap.m.Text({text:e.header})});f.addColumn(t)});var v=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var h=this.getView().getModel().bindContext(`/${"comment"}(...)`);n=/PAN_Number='([^']+)'/;m=location.href;g=m.match(n);a=g[1];var S={type:"get",NFA_Number:a};async function y(e,t){try{e=JSON.stringify(e);h.setParameter("data",e);await new Promise(e=>setTimeout(e,t));await h.execute();let a=h.getBoundContext();let o=a.getObject();o=JSON.parse(o.value);debugger;console.log("Execution Result:",o);if(o[0]&&o[0].Comments){v.setValue(o[0].Comments);console.log("Comment data updated:",o[0].Comments)}else{v.setValue("");console.warn("No comments found. Setting to empty.")}return o}catch(e){console.error("An error occurred:",e);throw e}}y(S,3e3).then(e=>console.log("Final Result:",e)).catch(e=>console.error("Execution Failed:",e))}}}})});
//# sourceMappingURL=Objectpage.controller.js.map