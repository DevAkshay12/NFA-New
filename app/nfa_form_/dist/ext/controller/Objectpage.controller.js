sap.ui.define(["sap/ui/core/mvc/ControllerExtension"],function(e){"use strict";var t;var a;var o;var s,n,i,r;n=/PAN_Number='([^']+)'/;o=location.href;r=o.match(n);if(r){a=r[1];console.log(a)}else{console.log("PAN Number not found")}return e.extend("nfaform.ext.controller.Objectpage",{override:{onInit:function(){},editFlow:{onBeforeSave:async function(e){i=this;const t=new Promise(async(t,o)=>{debugger;var s=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var n=s.getValue();var r=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");r.setUploadButtonInvisible(false);r.setUploadEnabled(false);if(r.getItems()){for(let e=0;e<r.getItems().length;e++){r.getItems()[0].setEnabledRemove(false);r.getItems()[0].setVisibleRemove(false)}}sap.m.MessageBox.confirm("Do you want to send for Approval?",{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:async function(r){if(r===sap.m.MessageBox.Action.YES){debugger;if(n.length==0){const e=new sap.ui.model.json.JSONModel([{type:"Error",title:"Comments Required",description:"Comments cannot be empty. Please enter a value",subtitle:"Comments section"}]);const t=new sap.m.MessagePopover({items:{path:"/",template:new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}"})}});t.setModel(e);t.openBy(s);o(true)}else{var l=sap.ushell.Container.getUser().getEmail();console.log("Save action confirmed");var m=e.context.getModel().bindContext(`/${"sendforapproval"}(...)`);var g={key:a,status:"Approval",name:l};g=JSON.stringify(g);m.setParameter("data",g);await m.execute();let o=m.getBoundContext();let s=o.getObject();t(true);i.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].addStyleClass("edit")}}else{console.log("Save action cancelled");t(true)}}})});await t},onAfterSave:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var o=t.getValue();if(o.length>0){console.log("Save action confirmed");debugger;var s=e.context.getModel().bindContext(`/${"comment"}(...)`);var n=sap.ushell.Container.getUser().getEmail();var i={type:"insert",NFA_Number:a,comment:o,user:n,status:"demo"};i=JSON.stringify(i);s.setParameter("data",i);await s.execute();let r=s.getBoundContext();let l=r.getObject();t.setEditable(false)}},onAfterDiscard:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var a=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var o=t.getValue();t.setEditable(false);a.setUploadButtonInvisible(true);a.setUploadEnabled(false);if(a.getItems()){for(let e=0;e<a.getItems().length;e++){a.getItems()[e].setEnabledRemove(false);a.getItems()[e].setVisibleRemove(false)}}},onBeforeEdit:async function(e){debugger;var t=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var a=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");a.setEditable(true);t.setUploadButtonInvisible(false);t.setUploadEnabled(true);if(t.getItems()){for(let e=0;e<t.getItems().length;e++){t.getItems()[e].setEnabledRemove(true);t.getItems()[e].setVisibleRemove(true)}}}},routing:{onAfterBinding:async function(e){debugger;var t;s=this;var o=s.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;const i=/PAN_Number='([^']+)'/;var r=location.href;const l=r.match(i);var m=o+`odata/v4/catalog/tab1?$filter=PAN_Number eq '${l[1]}'`;$.ajax({url:m,method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){debugger;t=e.value[0].status;if(t=="pending for Approval"||t=="Approved"){s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].addStyleClass("edit")}else{s.getView().getContent()[0].getHeaderTitle().mAggregations._actionsToolbar.getContent()[2].removeStyleClass("edit")}console.log("Data retrieved successfully:",e)}).catch(function(e){debugger;console.error("Error occurred during AJAX call:",e)});if(!this._attachmentsInitialized){this._attachmentsInitialized=true;var g=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Attachments--uploadSet");var u=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var c=location.href.match(/IsActiveEntity=([^,)]+)/);var d=c[1];if(d==="true"){u.setEditable(false);g.setUploadButtonInvisible(true);g.setUploadEnabled(false);if(g.getItems()){for(let e=0;e<g.getItems().length;e++){g.getItems()[0].setEnabledRemove(false);g.getItems()[0].setVisibleRemove(false)}}}else{u.setEditable(true);g.setUploadButtonInvisible(false);g.setUploadEnabled(true);if(g.getItems()){for(let e=0;e<g.getItems().length;e++){g.getItems()[0].setEnabledRemove(true);g.getItems()[0].setVisibleRemove(true)}}}}o=this.getView().getParent().getAppComponent().getManifestObject()._oBaseUri._string;debugger;var f=sap.ui.getCore().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Workflow--sampleTable");f.addStyleClass("workFlowTable");f.addStyleClass("sapUiRespGrid");f.addStyleClass("sapUiRespGridHSpace1");if(!f){console.error("Table not found.");return}var b={url:"/odata/v4/catalog/PAN_WORKFLOW_HISTORY_APR",method:"GET",headers:{Accept:"application/json"}};new Promise((e,t)=>{$.ajax(b).done(async(t,o,s)=>{var i=new sap.ui.model.json.JSONModel;m=location.href;n=/PAN_Number='([^']+)'/;c=m.match(n);a=c[1];const r=t.value.filter(e=>e.PAN_Number===a);i.setData({PAN_WORKFLOW_HISTORY_APR:r});f.setModel(i);console.log(t);await new Promise(e=>setTimeout(e,2e3));f.bindItems({path:"/PAN_WORKFLOW_HISTORY_APR",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{PAN_Number}"}),new sap.m.Text({text:"{Employee_Name}"}),new sap.m.Text({text:"{level}"}),new sap.m.Text({text:"{Notification_Status}"}),new sap.m.Text({text:"{Approved_by}"})]})});e(t)}).fail(e=>{t(e)})});var p=[{header:"PAN Number",path:"PAN_Number"},{header:"Employee Name",path:"Employee_Name"},{header:"Level",path:"level"},{header:"Status",path:"Notification_Status"},{header:"Approved By",path:"Approved_by"}];f.destroyColumns();p.forEach(function(e){var t=new sap.m.Column({header:new sap.m.Text({text:e.header})});f.addColumn(t)});var v=this.getView().byId("nfaform::tab1ObjectPage--fe::CustomSubSection::Justification--textareafrag");var h=this.getView().getModel().bindContext(`/${"comment"}(...)`);n=/PAN_Number='([^']+)'/;m=location.href;c=m.match(n);a=c[1];var S={type:"get",NFA_Number:a};S=JSON.stringify(S);h.setParameter("data",S);await h.execute();let y=h.getBoundContext();let C=y.getObject();C=JSON.parse(C.value);debugger;console.log("Execution Result:",C);if(C[0]&&C[0].Comments){v.setValue(C[0].Comments);console.log("Comment data updated:",C[0].Comments)}else{v.setValue("");console.warn("No comments found. Setting to empty.")}return C}}}})});
//# sourceMappingURL=Objectpage.controller.js.map